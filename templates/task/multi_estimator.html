{% extends "base.html" %}
{% block content %}


<div class="container">
    <h5 class="my-3 border-bottom pb-2"> 종합 견적서 작성하기 </h5>
    <form method="post" class="post-form my-3" id = "form123">
        {{form.media}}
        {% csrf_token %}
        {% if form.errors %}
            <div class="alert alert-danger" role="alert">
            {% for field in form %}
                {% if field.errors %}
                <strong>{{ field.label }}</strong>
                {{ field.errors }}
                {% endif %}
            {% endfor %}
            </div>
        {% endif %}

        <span>  1) 모달 띄우기 - Done </span>
        <br>
        <span>  2) 일단은, closet을 ''보내놓고'', 선택에 따라 ajax로 변경. - Done  </span>
        <br>
        <span>  3) 만약 type이 바뀌면 기존 것은 삭제하고 새 것 추가 </span>
        <br>
        <span>  4) 작성 버튼 클릭 시, 화면에 추가 </span>
        <br>
        <span>  5) 종합 버튼 클릭 시, multi_estimator_create로 보냄 </span>
        <br>
        <span>  6) 각 estimator별로 model 작성, container도 작성 및 저장 </span>
        <br>


        <button type="button" id = "add-button" class="btn btn-info" style ="margin-bottom:10px;">추가 항목 작성 &nbsp;<span style="font-size:16px; font-weight:bold;">+ </span></button>
        <br>


        <button type="submit" id = "submit"  class="btn btn-primary">견적서 작성하기</button>
    <!-- modal 구동 버튼 (trigger) -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal">
  Modal 띄우기
</button>


<!-- Modal -->
<div class="modal fade" id="modal" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Modal 제목</h4>
            </div>
            <div class="modal-body">Modal 내용
                <form method="post" class="post-form my-3" id = "form1">
                    {{form.media}}
                    {% csrf_token %}
                    {% if form.errors %}
                        <div class="alert alert-danger" role="alert">
                        {% for field in form %}
                            {% if field.errors %}
                            <strong>{{ field.label }}</strong>
                            {{ field.errors }}
                            {% endif %}
                        {% endfor %}
                        </div>
                    {% endif %}

                    <div class="form-group" id = "type_div">
                        <label for="type">type</label>
                        <select class="form-control" name="type" id="type" aria-label=".form-select-lg example" required>
                            <option value= "" disabled selected hidden>type select</option>
                            {% for type in types%}
                            <option value= {{type}}>{{type}}</option>
                            {% endfor %}
                        </select>
                    </div>

                </form>
            </div>


            <div class="modal-footer">
                <button id = "submit-modal"  class="btn btn-primary">제출하기</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
            </div>
        </div>
    </div>
</div>







{% endblock %}

{% block script %}

<script>

$(document).ready(function(){
    var type = document.getElementById('type');

    type.addEventListener('change', function() {
        let val = type.value;
        let param = {'type' : val,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'}

        console.log(val);

        $.ajax({
            url : "{% url 'task:estimator_add' %}",
            type : 'POST',
            datatype: 'json',
            data : param,

            success: function(data){

                console.log(data['types']);


                var type = $('#type_div');


                var children = type.parent().children();

                for (var i in children){
                    var child = children[i];
                    if (child.className == 'form-group' & child.id != 'type_div'){
                        console.log(child);
                        child.remove();
                        };
                    };




                for (var i in data['kwargs']){
                    let kwarg = data['kwargs'][i];
                    var structure = '';


                    structure = structure + '<div class="form-group">' ;
                    structure = structure + '<label for="' + kwarg.text + '">' + kwarg.text + '</label>';
                    structure = structure + '<input type="' + kwarg.type + '" class="form-control" name="' + kwarg.text + '" id="' + kwarg.text + '" rows="10" value="' + kwarg.value + '" min="' + kwarg.min + '" max="' + kwarg.max + '">';
                    structure = structure + '</div>'

                    structure = $(structure);


                    $(type).after(structure);

                    }
                },
            error : function(){
                console.log('error');
                }

            });
        });
    });


$(document).ready(function(){
//제츨하기 !

})


</script>
{% endblock %}


